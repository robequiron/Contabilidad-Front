<div nz-col [nzSpan]="12" style="padding-bottom: 10px;">
  <button nz-button nzType="primary" (click)="add()" [disabled]="!tax._id">
      <i nz-icon nzType="plus" nzTheme="outline"></i>
      <u>I</u>nsertar
  </button>
</div>


<nz-table #editRowTable nzBordered [nzData]="listOfData" nzTableLayout="fixed">
    <thead>
      <tr>
        <th nzWidth="40%">Nombre tipo impositivo</th>
        <th nzWidth="15%">%</th>
        <th nzWidth="15%">Fecha Inicio</th>
        <th nzWidth="15%">Fecha Fin</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of editRowTable.data">
        <ng-container *ngIf="!editCache[data.percentage].edit || !editCache[-1].edit ; else editTemplate">
          <td>{{ data.name }}</td>
          <td>{{ data.percentage }}</td>
          <td>{{ data.dateInit | date: 'd/M/yy'}}
          </td>
          <td>{{ data.dateEnd | date: 'd/M/yy'}}</td>
          <td>
            <a (click)="startEdit(data.percentage)">Edit</a>
            <nz-divider nzType="vertical"></nz-divider>
            <a nz-popconfirm nzPopconfirmTitle="Seguros de cancelar" (nzOnConfirm)="delete(data.percentage)">Eliminar</a>
          </td>
        </ng-container>

        <ng-template #editTemplate>
          <td>
            <!-- Input name -->
            <nz-form-control nzErrorTip="El campo no puede ser nulo. Debe contener 3 o mÃ¡s caracteres" [nzValidateStatus]="error.name">
              <input type="text" nz-input 
              [(ngModel)]="editCache[data.percentage].data.name" 
              #inputName="ngModel" name="name" 
              #iName
              (focus)="error.name=''"
              (focusout)="validate(inputName,data.percentage)" />
            </nz-form-control>
          </td>
          <td>
            <nz-form-control [nzErrorTip]="error.percentage[1]" [nzValidateStatus]="error.percentage[0]">
              <input type="number" nz-input [(ngModel)]="editCache[data.percentage].data.percentage" [disabled] = "!editCache[data.percentage].n"
              name="percentage" max="100"
              #iPercentage
              #inputPercentage="ngModel"
              (focusout)="validate(inputPercentage,data.percentage)"
              />
            </nz-form-control>
        </td>
          <td>
             <!-- Input dateInit -->
            <nz-form-control nzErrorTip="El campo no puede ser nulo" [nzValidateStatus]="error.dateInit">
              <nz-date-picker [(ngModel)]="editCache[data.percentage].data.dateInit" 
              nzFormat="dd.MM.yyyy" 
              nzPlaceHolder="F. Inicio" 
              #inputDateInit="ngModel" name="dateInit"
              (focusout)="validate(inputDateInit,data.percentage)"
              (ngModelChange)="validate(inputDateInit,data.percentage)">
              </nz-date-picker>
            </nz-form-control>
          </td>
          <td>
            <nz-form-control nzErrorTip="La fecha no puede ser anterior a la fecha de inicio" [nzValidateStatus]="error.dateEnd">
              <nz-date-picker [(ngModel)]="editCache[data.percentage].data.dateEnd" 
              nzFormat="dd.MM.yyyy" 
              nzPlaceHolder="F. Fin" 
              #inputDateEnd="ngModel" name="dateEnd"
              (focusout)="validate(inputDateEnd,data.percentage)"
              (ngModelChange)="validate(inputDateEnd,data.percentage)"></nz-date-picker>
            </nz-form-control>
          </td>
          <td>
            <a (click)="saveEdit(data.percentage)" 
            [attr.disabled]="editCache[data.percentage].validate"
            class="save">Save</a>
            <nz-divider nzType="vertical"></nz-divider>
            <a nz-popconfirm nzPopconfirmTitle="Sure to cancel?" (nzOnConfirm)="cancelEdit(data.percentage)">Cancel</a>
          </td>
        </ng-template>


      </tr>
    </tbody>
  </nz-table>
